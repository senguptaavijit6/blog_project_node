<%- include("../../../common/head.ejs") %>
<style>
	:root {
		--primary: #3a5a40;
		--secondary: #588157;
		--light: #f8f9fa;
		--dark: #212529;
		--accent: #dad7cd;
	}

	body {
		font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
		background-color: var(--light);
	}

	img {
		max-width: 100%;
		height: auto;
	}

	.navbar {
		box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
	}

	.navbar-brand {
		font-weight: 700;
		color: var(--primary) !important;
	}

	.nav-link {
		font-weight: 500;
		color: var(--dark) !important;
		transition: color 0.3s;
	}

	.nav-link:hover {
		color: var(--primary) !important;
	}

	.carousel-container {
		max-width: 100%;
		margin: 0 auto;
		box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
		border-radius: 12px;
		overflow: hidden;
	}

	.carousel-item {
		height: 550px;
		position: relative;
	}

	.carousel-item::before {
		content: '';
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		background: linear-gradient(to bottom, rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.7));
		z-index: 1;
	}

	.carousel-background {
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		object-fit: cover;
	}

	.carousel-caption {
		position: absolute;
		right: 15%;
		bottom: 20%;
		left: 15%;
		z-index: 10;
		padding-top: 20px;
		padding-bottom: 20px;
		text-align: left;
	}

	.main-heading {
		font-size: 3.2rem;
		font-weight: 800;
		margin-bottom: 15px;
		text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
		animation: fadeInUp 0.8s;
	}

	.sub-heading {
		font-size: 2.2rem;
		font-weight: 700;
		margin-bottom: 20px;
		text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
		animation: fadeInUp 1s;
	}

	.regular-heading {
		font-size: 1.4rem;
		font-weight: 400;
		max-width: 600px;
		margin-bottom: 30px;
		text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
		animation: fadeInUp 1.2s;
	}

	.carousel-cta {
		padding: 12px 30px;
		font-size: 1.1rem;
		font-weight: 600;
		text-transform: uppercase;
		border-radius: 50px;
		box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
		transition: all 0.3s ease;
		animation: fadeInUp 1.4s;
	}

	.carousel-cta:hover {
		transform: translateY(-3px);
		box-shadow: 0 6px 18px rgba(0, 0, 0, 0.3);
	}

	.carousel-indicators {
		margin-bottom: 30px;
	}

	.carousel-indicators [data-bs-target] {
		width: 12px;
		height: 12px;
		border-radius: 50%;
		background-color: rgba(255, 255, 255, 0.6);
		border: none;
		margin: 0 6px;
	}

	.carousel-indicators .active {
		background-color: #fff;
		transform: scale(1.2);
	}

	.carousel-control-prev,
	.carousel-control-next {
		width: 10%;
		opacity: 0.7;
	}

	.carousel-control-prev:hover,
	.carousel-control-next:hover {
		opacity: 1;
	}

	@keyframes fadeInUp {
		from {
			opacity: 0;
			transform: translate3d(0, 40px, 0);
		}

		to {
			opacity: 1;
			transform: translate3d(0, 0, 0);
		}
	}

	@media (max-width: 992px) {
		.main-heading {
			font-size: 2.6rem;
		}

		.sub-heading {
			font-size: 1.8rem;
		}
	}

	@media (max-width: 768px) {
		.carousel-item {
			height: 450px;
		}

		.main-heading {
			font-size: 2.2rem;
		}

		.sub-heading {
			font-size: 1.5rem;
		}

		.regular-heading {
			font-size: 1.2rem;
		}
	}

	.hero {
		padding: 6rem 0;
		background-color: #f7f7f7;
		border-radius: 0 0 20px 20px;
		margin-bottom: 4rem;
	}

	.hero h1 {
		color: var(--primary);
	}

	.btn-primary {
		background-color: var(--primary);
		border-color: var(--primary);
		border-radius: 30px;
		padding: 0.8rem 1.8rem;
		font-weight: 600;
	}

	.btn-primary:hover,
	.btn-primary:focus {
		background-color: var(--secondary);
		border-color: var(--secondary);
		transform: translateY(-2px);
	}

	.section-title {
		color: var(--primary);
		position: relative;
		padding-bottom: 1rem;
	}

	.section-title::after {
		content: "";
		position: absolute;
		bottom: 0;
		left: 50%;
		transform: translateX(-50%);
		width: 50px;
		height: 3px;
		background-color: var(--secondary);
	}

	.card {
		border: none;
		border-radius: 10px;
		overflow: hidden;
		box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
		transition: transform 0.3s;
		height: 100%;
	}

	.card:hover {
		transform: translateY(-5px);
	}

	.card-img-top {
		height: 200px;
		object-fit: cover;
	}

	.category-badge {
		background-color: var(--accent);
		color: var(--primary);
		font-size: 0.8rem;
	}

	.author-img {
		width: 30px;
		height: 30px;
	}

	.categories {
		background-color: #f7f7f7;
		border-radius: 20px;
		padding: 4rem 0;
	}

	.category-card {
		background-color: white;
		border-radius: 10px;
		padding: 1.5rem;
		text-align: center;
		box-shadow: 0 4px 10px rgba(0, 0, 0, 0.03);
		transition: transform 0.3s;
		height: 100%;
	}

	.category-card:hover {
		transform: translateY(-5px);
		box-shadow: 0 8px 15px rgba(0, 0, 0, 0.05);
	}

	.category-icon {
		font-size: 2rem;
		margin-bottom: 1rem;
		color: var(--primary);
	}

	.footer {
		background-color: var(--dark);
		color: white;
		padding: 4rem 0 2rem;
	}

	.footer h5 {
		color: var(--accent);
		margin-bottom: 1.5rem;
	}

	.footer-links {
		list-style: none;
		padding-left: 0;
	}

	.footer-links li {
		margin-bottom: 0.8rem;
	}

	.footer-links a {
		color: #aaa;
		text-decoration: none;
		transition: color 0.3s;
	}

	.footer-links a:hover {
		color: white;
	}

	.social-links a {
		display: inline-flex;
		align-items: center;
		justify-content: center;
		width: 40px;
		height: 40px;
		background-color: rgba(255, 255, 255, 0.1);
		border-radius: 50%;
		color: white;
		margin-right: 0.5rem;
		transition: background-color 0.3s;
	}

	.social-links a:hover {
		background-color: var(--primary);
		text-decoration: none;
	}

	.copyright {
		border-top: 1px solid rgba(255, 255, 255, 0.1);
		padding-top: 2rem;
		color: #aaa;
	}
</style>
</head>

<body>
	<!-- Navigation -->
	<nav class="navbar navbar-expand-lg navbar-light bg-white sticky-top">
		<div class="container">
			<a class="navbar-brand" href="/"><%= siteName %></a>
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarNav">
				<ul class="navbar-nav ms-auto">
					<li class="nav-item">
						<a class="nav-link" href="/">Home</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="/getAllCategoriesWithPagination?page=1&limit=10">Categories</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="/getAllTagsWithPagination?page=1&limit=10">Tags</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="#">Featured</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="/aboutUs">About</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="/contactUs">Contact</a>
					</li>
				</ul>
			</div>
			<!-- Navbar Search-->
			<form class="d-none d-md-inline-block form-inline ms-auto me-0 me-md-3 my-2 my-md-0" action="/search" method="post">
				<div class="input-group">
					<input class="form-control" type="text" name="searchSlug" placeholder="Search for blogs" aria-label="Search for blogs" aria-describedby="btnNavbarSearch" style="border-radius: 30px 0 0 30px;"/>
					<button class="btn btn-primary" id="btnNavbarSearch" type="submit"><i class="fas fa-search"></i></button>
				</div>
			</form>
		</div>
		<ul class="navbar-nav ms-auto ms-md-0 me-3 me-lg-4">
			<li class="nav-item dropdown">
				<a class="nav-link dropdown-toggle" id="navbarDropdown" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
					<% console.log("user from singleBlogPage", user) %>
					<% if(user && user.role !== "admin") { %>
					<img src="/assets/img/avatars/<%= user.avatar %>.png" style="width: 30px; height: 30px; object-fit: cover; border-radius: 100px;">
					<% } else if(user && user.role === "admin") { %>
					<img src="/uploads/profile_picture/admin/<%= user.image %>" style="width: 30px; height: 30px; object-fit: cover; border-radius: 100px;">
					<% } else { %>
					<i class="fa-solid fa-user"></i>
					<% } %>
				</a>
				<ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
					<% if(!user) { %>
					<li><a class="dropdown-item" href="/loginPage">Login</a></li>
					<li><a class="dropdown-item" href="/admin/loginPage">Login as Admin</a></li>
					<% } else if (user && user.role !== "admin"){ %>
					<li><a class="dropdown-item" href="/settings">Settings</a></li>
					<li><a class="dropdown-item" href="/logout">Logout</a></li>
					<% } else if (user && user.role === "admin") { %>
					<li><a class="dropdown-item" href="/admin/settings">Settings</a></li>
					<li><a class="dropdown-item" href="/admin/logout">Logout</a></li>
					<% } %>
					<!-- <li><a class="dropdown-item" href="/admin/settings/">Settings</a></li>
                        <li><a class="dropdown-item" href="#!">Activity Log</a></li>
                        <li>
                            <hr class="dropdown-divider" />
                        </li>
                        <li><a class="dropdown-item" href="/admin/logout">Logout</a></li> -->
				</ul>
			</li>
		</ul>
	</nav>

	<section class="col-sm-12 col-md-10 col-lg-8 mx-auto mt-5 mb-5">
		<%- include("../../../common/alerts.ejs") %>
		<div class="row border pt-2">
			<div class="col-12">
				<h2>
					<%= blogResponse.title %> 
					<span>
						<% if(blogResponse.authorName && blogResponse.authorName._id) { %>
							<% if(isUserAuthorSame) { %>
								<span style="color: cornflowerblue;">by You</span>
							<% } else { %>
								<span style="color: cornflowerblue;">by <%= blogResponse.authorName.firstName + " " + blogResponse.authorName.lastName %></span>
							<% } %>

						<% } else { %>
							<span style="color: cornflowerblue;">by <%= blogResponse.authorName.firstName + " " + blogResponse.authorName.lastName %></span>
						<% } %>
					</span>
				</h2>
				<h5>
					<% blogResponse.tagDetails.map( tag=> { %>
					<span class="mr-2 text-primary">#<%= tag.name %></span>
					<% }) %>
				</h5>
				<img src="/uploads/blog_image/<%= blogResponse.image %>" alt="Featured Blog Image" style="width: 100%; height: 50vh; object-fit: cover;">
				<div class="rounded my-2 " style="background-color: antiquewhite; padding: 20px;">

					<div class="d-flex align-items-center">
						<% blogResponse.categoryDetails.map( category=> { %>
						<span class="badge bg-success me-2">
							<%= category.name %>
						</span>
						<% }) %>
					</div>

					<% if (isLikedByThisUser !== undefined) { %>
					<a href="/withdrawLikeBlog/<%= blogResponse._id %>"><i class="fa-solid fa-heart"></i></a>
					<% } else { %>
					<a href="/likeBlog/<%= blogResponse._id %>"><i class="fa-regular fa-heart"></i></a>
					<% } %>
					<span class="ms-1 me-2">
						<%= blogResponse.likedCount %>
					</span>

					<% if (isDislikedByThisUser !== undefined) { %>
					<a href="/withdrawDislikeBlog/<%= blogResponse._id %>"><i class="fa-solid fa-thumbs-down"></i></a>
					<% } else { %>
					<a href="/dislikeBlog/<%= blogResponse._id %>"><i class="fa-regular fa-thumbs-down"></i></a>
					<% } %>
					<span class="ms-1 me-2">
						<%= blogResponse.dislikedCount %>
					</span>

					<i class="fa-solid fa-eye"></i><span class="ms-2"><%= blogResponse.views.length %></span>


					<!-- <span class="ms-2"><%= // blogResponse.comments.length %> Comments</span> -->

				</div>
				<div class="p-3"><%- blogResponse.content %></div>
			</div>
		</div>
		<!-- Post Comment-->
		<% if(user) { %>
		<div class="row border mt-2 py-2">
			<div class="col-12">
				<div class="d-flex w-100">
					<img src="<%= user.role !== 'admin' ? `/assets/img/avatars/${user.avatar}.png` : `/uploads/profile_picture/admin/${user.image}` %>" alt="user-avatar" style="width: 30px; height: 30px; object-fit: cover; border-radius: 100px; margin-right: 10px; margin-top: 5px;">
					<form action="/createComment/<%= blogResponse._id %>" method="post" style="width: 100%;">
						<div class="d-flex align-items-end">
							<textarea name="content" id="" style="height: 100px; width: 100%; padding: 10px; margin-right: 10px;" placeholder="add a comment"></textarea>
							<button type="submit" style="border: none; border-radius: 100px; padding: 0;">
								<img src="/assets/img/send.png" alt="comment button" style="height: 36px;">
							</button>
						</div>
					</form>
				</div>
			</div>
		</div>
		<% } %>

		<!-- All Comments Section -->
		<% if( blogResponse.commentsDetails?.length > 0 ) { %>
		<div class="row border mt-2 pt-2">
			<div class="col-12">
				<h4>Comments</h4>
				<% blogResponse.commentsDetails?.map( (comment, index) => { %>
				<div class="d-flex w-100 border-bottom py-2">
					<img src="<%= comment?.commentOwner?.role !== 'admin' ? `/assets/img/avatars/${comment?.commentOwner?.avatar}.png` : `/uploads/profile_picture/admin/${comment?.commentOwner?.image}` %>" alt="user-avatar" style="width: 30px; height: 30px; object-fit: cover; border-radius: 100px; margin-right: 10px;">
					<div class="w-100">
						<h6><%= comment?.commentOwner?.firstName + " " + comment?.commentOwner?.lastName %></h6>
						<p><%= comment?.content %></p>
						<button type="button" class="btn btn-link" data-bs-toggle="modal" data-bs-target="#exampleModal<%= index %>">
							reply
						</button>

						<!-- Replies -->
						<% if(comment?.replies?.length > 0) { %>
							<% comment.replies.map(reply => { %>
								<div class="d-flex border-bottom p-2 ms-3 mb-2" style="border: 1px solid #00000030; max-width: 100%; border-radius: 10px;">
									<img src="<%= reply?.replyOwner?.role !== 'admin' ? `/assets/img/avatars/${reply?.replyOwner?.avatar}.png` : `/uploads/profile_picture/admin/${reply?.replyOwner?.image}` %>" alt="user-avatar" style="width: 30px; height: 30px; object-fit: cover; border-radius: 100px; margin-right: 10px;">
									<div class="w-100">
										<h6><%= reply?.replyOwner?.firstName + " " + reply?.replyOwner?.lastName %></h6>
										<p><%= reply?.content %></p>
									</div>
									<div><a href="/removeReply?commentId=<%= comment._id %>&replyId=<%= reply._id %>&blogId=<%= blogResponse._id %>" style="color: red;"><i class="fa-solid fa-trash-can"></i></a></div>
								</div>
							<% }) %>
							
						<% } %>

						<!-- Modal -->
						<div class="modal fade" id="exampleModal<%= index %>" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
							<div class="modal-dialog">
								<div class="modal-content">
									<form action="/replyComment?blogId=<%= blogResponse._id %>&commentId=<%= comment._id %>" method="post">
										<div class="modal-header">
											<h5 class="modal-title" id="exampleModalLabel">
												Reply to <%= comment?.commentOwner?.firstName + " " + comment?.commentOwner?.lastName %>
											</h5>
											<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
										</div>
										<div class="modal-body">
											<input type="text" name="content" id="" style="height: 100px; width: 100%; padding: 10px; margin-right: 10px;" placeholder="add a reply">

										</div>
										<div class="modal-footer">
											<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
											<button type="submit" class="btn btn-primary">Reply</button>
										</div>
									</form>
								</div>
							</div>
						</div>


					</div>
					<div><a href="/removeComment/<%= comment._id %>" style="color: red;"><i class="fa-solid fa-trash-can"></i></a></div>
				</div>
				<% }) %>
			</div>
		</div>
		<% } %>
	</section>

	<!-- Newsletter Section -->
	<!-- <section class="py-5">
		<div class="container">
			<div class="row justify-content-center">
				<div class="col-lg-8 text-center">
					<h2 class="section-title mb-4">Join Our Newsletter</h2>
					<p class="text-muted mb-4">Get weekly updates with the best articles directly in your inbox. No
						spam, just the content you love.</p>
					<form class="row g-3 justify-content-center">
						<div class="col-md-8">
							<input type="email" class="form-control form-control-lg rounded-pill" placeholder="Your email address" required>
						</div>
						<div class="col-md-4">
							<button type="submit" class="btn btn-primary w-100 rounded-pill">Subscribe</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</section> -->

	<!-- Footer -->
	<%- include("../../../common/homePageFooter.ejs") %>

	<%- include("../../../common/scripts.ejs") %>

</body>

</html>
